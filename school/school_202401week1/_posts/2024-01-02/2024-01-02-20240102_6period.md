---
title: "2024년 01월 02일 6교시 요약"
tag: 202401_school
---

### 문제

- 업로드 결과를 이용자에게도 알려준다.


#### UploadForm.jsp

```html
<%@ page contentType="text/html; charset=utf-8" pageEncoding="utf-8"%>
<%@ taglib prefix="c" uri="http://java.sun.com/jsp/jstl/core" %>
<c:set var="ctx" value="<%=request.getContextPath()%>"/>
<!DOCTYPE html>
<html>
<head>
<meta charset="utf-8">
<title>파일 업로드 폼</title>
<style type="text/css">
   fieldset { width:fit-content; border:1px dotted black;margin:1em;}
</style>
</head>
<body>
   <form method="post" action="${ctx}/up" enctype="multipart/form-data">
      <input type="hidden" name="cmd" value="add">
      <fieldset>
         <legend>텍스트 필드</legend>
         <div>제목 <input type="text" name="title" value="업로드 테스트"></div>
         <div>설명 <input type="text" name="desc" value="간단한 샘플 데이터 첨부"></div>
       </fieldset>
       <fieldset>
         <legend>파일 필드</legend>
         <div><input type="file" name="file1" /></div>
         <div><input type="file" name="file2" /></div>
       </fieldset>
       <div id="btn">
          <button type="reset">취소</button>
          <button id="btnUpload" type="submit">업로드</button>
       </div>
   </form>
</body>
</html>
```

#### UploadServlet.java

```java
package com.ezenac.web;

import java.io.IOException;
import java.util.*;

import jakarta.servlet.ServletException;
import jakarta.servlet.annotation.MultipartConfig;
import jakarta.servlet.annotation.WebServlet;
import jakarta.servlet.http.HttpServlet;
import jakarta.servlet.http.HttpServletRequest;
import jakarta.servlet.http.HttpServletResponse;
import jakarta.servlet.http.Part;

@WebServlet("/up") 
@MultipartConfig(
      fileSizeThreshold = 0,
      maxFileSize = 1024*1024*10,
      maxRequestSize = 1024*1024*50
)
public class UploadServlet extends HttpServlet 
{
   @Override
   protected void service(HttpServletRequest request, HttpServletResponse response) throws ServletException, IOException {
      request.setCharacterEncoding("utf-8");
      response.setContentType("text/html;charset=utf-8");
      
      // 파일이 아닌 일반 폼 필드는 아래처럼 추출할 수 있다
      String title = request.getParameter("title");
      String desc = request.getParameter("desc");
      System.out.printf("%s, %s \n", title, desc);

      Collection<Part> fileParts = request.getParts();
      Iterator<Part> it = fileParts.iterator();
      
      List<String> list = new ArrayList<String>();
      
      while(it.hasNext()) {
         Part p = it.next();
         
         String name = p.getName();             //form field name
         if(!name.startsWith("file")) {
            continue;
         }
         String fname = p.getSubmittedFileName(); //file name

         if(fname==null || fname.equals("")) continue; //파일필드가 비어 있는 경우
         
         long size = p.getSize();
         String contentType = p.getContentType();
         
         p.write("D:/JavaTest/test/upload/"+fname); //파일저장, 해당 디렉토리가 없으면 오류발생
         
         String s = String.format("%s,%s,%s,%s \n", name, fname, size, contentType);
         list.add(s);
         System.out.printf("%s,%s,%s,%s \n", name, fname, size, contentType);
      }
      
      request.setAttribute("list",list);
      request.getRequestDispatcher("/upload/upResult.jsp").forward(request, response);
   }
}
```

#### upResult.jsp

```html
<%@ page language="java" contentType="text/html; charset=UTF-8"
    pageEncoding="UTF-8"%>
<%@ taglib prefix="c" uri="http://java.sun.com/jsp/jstl/core"%>
<!DOCTYPE html>
<html>
<head>
<meta charset="UTF-8">
<title>확인</title>
</head>
<body>

<c:forEach var="s" items="${list}" >
	${s}<br>
</c:forEach>

</body>
</html>
```

<br>

- event.preventDefault() : 기본으로 지정된 작업을 방지하기 위한 메소드
- $('#uploadForm')[0] : jQuery 오브젝트로부터 Javascript 표준 오브젝트 추출
- new FormData(form) : FormData 객체는 Javascript 표준 오브젝트만 매개변수로 받아들이기 때문에 이런 과정이 필요함
- $('#btnUpload').prop('disabled',true) : 버튼을 비활성화 시킨다. 한번 눌러서 모든 과정이 처리될 때까지 비활성화 시킨다. 
- processData: false : 디폴트인 Query String 변환하지 않도록 설정
- contentType: false : 디폴트 "application/x-www-form-urlencoded; charset=UTF-8"
- timeout: 600000 : 시간 제한 없음, 파일 올려서 응답을 받을 때까지의 시간을 제한

### 문제

- 파일업로드를 이용한 PDS(Public Data Service) 만들기 프로젝트(UI 구현)
  - AJAX 파일 업로드 사용
  - 작성자, 작성일, 파일명, 파일 사이즈, contenttype
  - 위의 정보가 직렬화되어 파일에 저장되도록 함(pds,ser)
  - pdsList.jsp를 요청하면 업로드된 파일의 정보 리스트가 테이블에 정렬되어 표시된다.
  - Model 1 사용